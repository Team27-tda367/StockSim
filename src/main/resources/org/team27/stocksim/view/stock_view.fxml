<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.chart.LineChart?>
<?import javafx.scene.chart.NumberAxis?>



<BorderPane xmlns="http://javafx.com/javafx/17"
    xmlns:fx="http://javafx.com/fxml/1" fx:controller="org.team27.stocksim.view.fx.viewControllers.StockViewController" stylesheets="@../css/main.css">


    <top>
        <HBox alignment="CENTER_LEFT" styleClass="header-bar, spacing-large">
            <Label text="StonkSim" styleClass="logo"/>
            <Button text="Home" styleClass="btn-ghost" onAction="#onMainView"/>

            <Button text="Portfolio" styleClass="btn-ghost" onAction="#onPortfolioView"/>
            <!-- 
            <Button text="Create Stock" styleClass="btn-ghost" onAction="#onExample"/> -->
            <Region HBox.hgrow="ALWAYS"/>
            <VBox alignment="CENTER_RIGHT" styleClass="spacing-small">
                <Label fx:id="availableBalanceLabel" text="Available Balance" styleClass="text-small, text-muted"/>
            </VBox>
        </HBox>
    </top>

    <center>
        <HBox alignment="TOP_LEFT" spacing="24">
            <padding>
                <Insets top="30" left="30" bottom="30" right="30"/>
            </padding>

            <!-- StockInfo & Price History Combined -->
            <VBox HBox.hgrow="ALWAYS" prefWidth="1020" styleClass="panel-card" spacing="20">
                <!-- Stock Info Header -->
                <BorderPane>
                    <left>
                        <VBox spacing="8" alignment="TOP_LEFT">
                            <Label fx:id="symbolLabel" text="AAPL" styleClass="stock-title"/>
                            <Label fx:id="nameLabel" text="Apple Â· Inc. Â· Listed on Stock Exchange" styleClass="stock-subtitle"/>
                            <HBox spacing="6">
                                <Label text="Technology" styleClass="badge, badge-blue"/>
                                <Label text="Growth" styleClass="badge, badge-green"/>
                            </HBox>
                        </VBox>
                    </left>
                    <right>
                        <Button fx:id="favoriteButton" styleClass="favorite-btn" onAction="#onToggleFavorite">
                            <graphic>
                                <Label fx:id="favoriteIcon" text="â˜†" styleClass="favorite-icon"/>
                            </graphic>
                        </Button>
                    </right>
                </BorderPane>

                <!-- Price History Chart -->
                <VBox spacing="12" styleClass="chart-section">
                    <HBox alignment="CENTER_LEFT">
                        <Label text="Price History" styleClass="chart-title"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <HBox spacing="4">
                            <Button fx:id="btn1D" text="1D" styleClass="time-period-btn" onAction="#onTimePeriodClick"/>
                            <Button fx:id="btn1W" text="1W" styleClass="time-period-btn" onAction="#onTimePeriodClick"/>
                            <Button fx:id="btn1M" text="1M" styleClass="time-period-btn" onAction="#onTimePeriodClick"/>
                            <Button fx:id="btn1Y" text="1Y" styleClass="time-period-btn" onAction="#onTimePeriodClick"/>
                        </HBox>
                    </HBox>
                    <LineChart fx:id="priceChart" prefHeight="450" legendVisible="false" style="-fx-background-color: transparent;" VBox.vgrow="ALWAYS">
                        <xAxis>
                            <NumberAxis side="BOTTOM" label="Time" autoRanging="true" tickLabelFill="#6B7280"/>
                        </xAxis>
                        <yAxis>
                            <NumberAxis side="LEFT" label="Price (SEK)" autoRanging="true" tickLabelFill="#6B7280" forceZeroInRange="false" minorTickVisible="false"/>
                        </yAxis>
                    </LineChart>
                </VBox>
            </VBox>

            <!-- 4  boxes on the right -->
            <VBox prefWidth="300" spacing="8">

                <!-- ðŸ”¹ TOP TRENDING PANEL -->
                <VBox>
                    <HBox alignment="CENTER_LEFT" styleClass="panel-header">
                        <Label text="Top Trending Stocks" styleClass="panel-title"/>
                    </HBox>
                    <VBox fx:id="trendingStocksContainer" styleClass="panel-body" spacing="2">
                        <!-- Trending stocks will be populated here dynamically -->
                    </VBox>
                </VBox>

                <!-- ðŸ”¹ RELATED STOCKS PANEL -->
                <VBox>
                    <HBox alignment="CENTER_LEFT" styleClass="panel-header">
                        <Label text="Related Stocks" styleClass="panel-title"/>
                    </HBox>
                    <VBox styleClass="panel-body">
                        <Region style="-fx-background-color: transparent;" minHeight="120"/>
                    </VBox>
                </VBox>

                <!-- Box 3  -->
                <VBox styleClass="stock-price-card" prefWidth="300" minHeight="120" maxHeight="120" spacing="4">

                    <HBox alignment="CENTER_LEFT" spacing="4">
                        <Label text="High" styleClass="price-title-small"/>
                        <Label text="187.37" styleClass="price-value-compact"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <Label text="Low" styleClass="price-title-small"/>
                        <Label text="169.53" styleClass="price-value-compact"/>
                    </HBox>

                    <HBox spacing="3" alignment="CENTER_LEFT">
                        <Label text="ðŸ“ˆ" styleClass="price-icon-small"/>
                        <Label text="+1.33% (+2.34)" styleClass="price-change-compact"/>
                    </HBox>

                    <VBox spacing="0">
                        <Label fx:id="priceLabel" text="178.45" styleClass="price-value-main" maxWidth="Infinity" wrapText="false"/>
                        <Label text="Last paid price" styleClass="price-title-small"/>
                    </VBox>

                </VBox>


                <!-- Box 4  -->
                <VBox fx:id="orderCard" prefWidth="340" prefHeight="140" spacing="6" styleClass="order-card">

                    <Label text="Quantity" styleClass="label-title"/>
                    <TextField fx:id="quantityField" text="1" prefHeight="24" onKeyTyped="#validateNumberInput" promptText="Enter quantity"/>

                    <HBox spacing="8" alignment="CENTER_LEFT">
                        <Label text="Price" styleClass="label-title"/>
                        <Button text="Market" styleClass="btn-ghost" prefHeight="20" onAction="#handleSetMarketPrice"/>
                    </HBox>
                    <TextField fx:id="priceField" prefHeight="24" onKeyTyped="#validatePriceInput" promptText="Enter price"/>

                    <VBox styleClass="info-box">
                        <HBox>
                            <Label text="Price" styleClass="info-header"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Label fx:id="orderPriceLabel" text="178.45 SEK" styleClass="info-label"/>
                        </HBox>

                        <HBox>
                            <Label text="Qty" styleClass="info-header"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Label fx:id="orderQuantityLabel" styleClass="info-label"/>
                        </HBox>

                        <HBox>
                            <Label text="Total" styleClass="info-header"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Label fx:id="orderTotalLabel" text="178.45 SEK" styleClass="info-label"/>
                        </HBox>
                    </VBox>

                    <HBox alignment="CENTER" spacing="12" prefWidth="300">
                        <Button text="Buy" prefHeight="34" prefWidth="140" styleClass="buy-btn, btn-highlighted" onAction="#handleBuy"/>
                        <Button text="Sell" prefHeight="34" prefWidth="140" styleClass="sell-btn, btn-secondary" onAction="#handleSell"/>
                    </HBox>


                </VBox>

            </VBox>


        </HBox>
    </center>

</BorderPane>